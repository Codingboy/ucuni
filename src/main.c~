#include "main.h"
#include "led.h"
#include "button.h"
#include <util/delay.h>
#include <stdlib.h>
#include "time.h"
#include <USB.h>

ISR(TIMER0_OVF_vect)//each 100Âµs
{
	_time += 100;
	TCNT0 = 230;
}

int main(int argc, char* argv[])
{
	global_led1 = allocLed(1, 0);//B0
	global_led2 = allocLed(1, 1);//B1
	global_but1 = allocButton(1, 2);//B2
	setTime(0);
	enableTime();
	u64 time;
	while (1)
	{
		time = getTime();
		if (time > 1000000)
		{
			setTime(0);
		}
		if (time%1000000 < 100000)
		{
			onLed(global_led1);
		}
		else
		{
			offLed(global_led1);
		}
		u8 butState = stateButton(global_but1);
		if (butState)
		{
			onLed(global_led2);
		}
		else
		{
			offLed(global_led2);
		}
		USB_USBTask();
	}
	freeLed(&global_led1);
	freeLed(&global_led2);
	freeButton(&global_but1);
	return 0;
}
